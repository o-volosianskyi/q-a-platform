$("#modal-window-sign-in").find(".modal-content").html("<%= j (render 'sign_in_form') %>");
$("#modal-window-sign-in").modal();

$('#sign_in_user')
.bind('ajax:success', function(evt, data, status, xhr) {
  //function called on status: 200 (for ex.)
  $('#modal-window-sign-in').modal('toggle');
  $("#session-actions").empty().html('<%= link_to "Sign out", destroy_user_session_path, :method => :delete, :class => "btn btn-small" %>')
})
.bind("ajax:error", function(evt, xhr, status, error) {
  $("#sign_in_error").removeClass('d-none');
  $("#sign_in_error").append(`<br/> (${pareseErrors(xhr.responseText) || 'Incorrect login or password' })`)
});

$('#sign_in_user').on('submit', function () {
  resetErrors();
});

$('#modal-window-sign-in').on('hidden.bs.modal', function () {
  resetErrors();
});

resetErrors = () => {
  $("#sign_in_error").addClass('d-none');
  $("#sign_in_error").empty().append('Oops! Couldn\'t sign you in.')
}

pareseErrors = (errors) => {
  errorMessage = '';
  try {
    errors = JSON.parse(errors);
    let errorMessage = '';
    for (const key in errors['errors']) {
      errorMessage += `\n ${key}: ${errors['errors'][key]}`;
    }
    return errorMessage;
  } catch (e) {
    return null;
  }
}
